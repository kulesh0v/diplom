\chapter{ОСНОВНЫЕ ПОНЯТИЯ И ОБЗОР ЛИТЕРАТУРЫ }\label{chap1}
В настоящей глава описываются основные понятия MPC. Приводится классификация принципов управления, используемых в современной теории управления. А также рассматривается вохможность представления входных и выходных сигналов дискретных стационарных линейных систем на основе матрицы Ганкеля для MPC.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Теория управления по прогнозирующей модели}\label{1sec:MPC}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


Главная идея MPC \cite{Mayne} -- использование математической модели управляемого процесса в пространстве состояний для предсказания и оптимизации будущего поведения системы.
Рассмотрим задачу стабилизации нелинейной системы 
\begin{equation}\label{x(t+1)}
	x(t+1)=f(x(t),u(t)),\, t=0,1,\dots,
\end{equation}
где 
\newline
	$x=x(t) \in \mathbb{R}^n$ -- состояние системы в момент времени $t$;\newline
	$u=u(t) \in \mathbb{R}^r$ -- значение управляющего воздействия в момент времени $t$;
$f: \mathbb{R}^n \times \mathbb{R}^r \rightarrow \mathbb{R}^n$ -- заданная функция.
\par Пусть $f(0,0)=0$, следовательно точка равновесия системы находится в начале координат, и при тривиальном управлении $u\equiv0$ система остаётся в состоянии покоя.
\par При заданном управлении $u(\cdot)$, траектория системы (\ref{x(t+1)}) обозначается как $x(t|0,z,u(\cdot)), \, t=0,1,\dots$, где начальное состояние системы в момент времени $t=0$ задаётся условием $x(0)=z$.
\par Управление $u(\cdot)$ будем выбирать так, чтобы максимально приблизить траектории $x(t|0,x_0,u(\cdot)), \, t=0,1,\dots,N,$ к началу координат.

\newtheorem{Def}{Определение}
\begin{Def}
	Стоимость этапа -- функция $l(x(t),u(t))$ вдоль траектории $x(\cdot)$ и управления $u(\cdot)$, с помощью которой для всех моментов времени $t=0,1,\dots$ оценивается качество выбранного урпавления $u(\cdot)$.
\end{Def}

Чаще всего стоимость этапа $l$ выбирается следующим образом:
\begin{enumerate}
	\item Взвешенная сумма расстояний до начала координат:
	\begin{center}
		$l(x,u)=\parallel x\parallel ^2+\lambda\parallel u\parallel ^2, \quad
\lambda \geq 0$ -- параметр, $\parallel \cdot \parallel$ -- евклидова норма.
	\end{center}
	\item Квадратичные функции
	\begin{center}
		$l(x,u)=x'Qx+u'Ru$
	\end{center}
$R,Q>0$ -- положительно-определённые матрицы.
\end{enumerate}
\bigskip

Таким образом задача оптимального управления состоит в минимизации функционала, где минимум ищем вдоль траекторий $x(t|0,x^*(\tau),u(\cdot)), t=0,1,\dots, N-1$, системы (\ref{x(t+1)}) с начальным состоянием, совпадающим с текущим состоянием объекта $x(0)=x^*(\tau)$ и при некоторых ограничениях:
\begin{equation}\label{J(x^*(tau))}
	J(x^*(\tau))=\min_{u(\cdot)}\sum_{t=0}^{N-1} l(x(t|0,x^*(\tau),u(\cdot)),u(t)).
\end{equation}

Ограничения для задачи (\ref{J(x^*(tau))}) состояит из двух групп:
\begin{enumerate}
 \item Физические ограничения системы (например, неотрицательность переменных, максимальное ограничение на управляющее воздействие и другие);
 \item Ограничения, накладываемые алгоритмом MPC (например, терминальное ограничение вида $x(N)=0$ или принадлежность $x(N)$ множеству $X_f$).
\end{enumerate}

Обозначим оптимальное программное решение задачи (\ref{J(x^*(tau))}) через $u^0(\cdot|x^*(\tau))$. Для построения обратных связей будем считать, что на объект
управления подано первое значение оптимальной программы 
\begin{center}
	$\mu(x^*(\tau))=u^0(0|x^*(\tau)).$
\end{center}

Далее в момент времени $\tau + 1$ процесс повторяется для состояния
$x^*(\tau+1)$. Тогда в этот момент времени решается задача о минимизации следующего функционала:
\begin{center}
	$
	J(x^*(\tau+1))=\underset{{u(\cdot)}}\min\sum_{t=0}^{N-1} l(x(t|0,x^*(\tau+1),u(\cdot)),u(t)).$
\end{center}


При этом будет получено очередное значение обратной связи:
\begin{displaymath}
	\mu(x^*(\tau+1))=u^0(0|x^*(\tau+1)).
\end{displaymath}
После процесс повторяется при $\tau + 2, \tau + 3$ и так далее.
Таким образом, алгоритм управления по прогнозирующей модели, в каждый момент времени $\tau = 0,1,\dots$ состоит из следующих шагов:
\begin{enumerate}
	 \item Измеряется текущее состояние $x^*(\tau)$
	 \item Находится оптимальное программное решение $u^0(t|x^*(\tau))$ задачи (\ref{J(x^*(tau))}).
	 \item Подаётся на объект системы управляющее воздействие 
	\begin{center}
		 $\mu^*(\tau)  \equiv \mu(x^*(\tau))=\mu^0(0|x^*(\tau))$.
	\end{center}		 
\end{enumerate}

\indent Идея упрваления по прогнозирущей модели заключается в оптимизации будущего поведения системы в каждый момент времени, нахождение оптимального управления и его использования в качестве значений обратной связи для следующего момента времени.


\section{Задачи оптимального управления}\label{2sec:POC}

Задачи оптимального управления классифицируются \cite{Alsevich}
\begin{itemize}
	\item По промежутку управления:
	\begin{itemize}
		\item задачи оптимального управления разделяются на непрерывные $T = [t_0,t_f]$ и дискретные, в которых динамический процесс рассматривается в дискретные моменты времени $k=0,1,\dots,N, \: N $ --  натуральное число.	
		\item задачи различаются по продолжительности процесса  с фиксированным и нефиксированном $t_f$. 


	\end{itemize}
	\item По ограничениям на траекторию, которые в общем виде имеют следующий вид:
	\begin{center}
		$x\in\mathbb{X}(t), t\in[t_0,t_f]$.
	\end{center}
	Ограничения на траекторию могут накладываться:
	\begin{itemize}
		\item на правом конце траектории(терминальные ограничения), т.е. $x(t_f)\in\mathbb{X}_f$;
		\item на левом конце, т.е. $x(t_0)\in\mathbb{X}_0$;
		\item  в промежуточные моменты времени, т.е. $x(t_i)\in\mathbb{X}_i,t_i\in[t_0,t_f],i=1,...,l$, при этом $t_0<t_1<\dots<t_l<t_f.$
	\end{itemize}
	Также существуют смешанные ограничения на траекторию.
	\item По критерию качества: \\
	\begin{itemize}
	\item Терминальный критерий качества типа Майера
	\begin{displaymath}
		J(u)=\varphi(x(t_f)),
	\end{displaymath}
	\begin{displaymath}
		 \varphi: R^n \rightarrow R.
	\end{displaymath}
	\item Интегральный критерий типа Лагранжа
	\begin{displaymath}
 		J(u)=\int\limits_{t_0}^{t_f} f_0(x(t),u(t),t) \,dt,
	\end{displaymath}
 	\begin{displaymath}	
		f_0\, : \,R^n \times R^r \times R \rightarrow R.
	\end{displaymath}
	\item Критерий качества типа Бальса
		\begin{displaymath}
			J(u)=\varphi(x(t_f))+\int\limits_{t_0}^{t_f} f_0(x(t),u(t),t) \,dt.
		\end{displaymath}
	\item Критерий быстродействия
	\begin{displaymath}
		J(u)=t_f-t_0 \rightarrow \min.
	\end{displaymath}
	\end{itemize}
\end{itemize}

Принцип максимума -- классическое необходимое условие оптимальности для задач оптимального управления. Оно является самым сильным из известных необходимых условий оптимальности первого порядка.

Для формулировки принципа максимума введем гамильтониан:
\begin{displaymath}
	H(x,\psi,u,t)=\psi'f(x,u,t)=\sum^n_{j=1}\psi_j f_j(x,u,t)
\end{displaymath}

Рассмотрим простейшую задачу оптимального управления на промежутке времени $[t_0,t_f]$ в классе кусочно-непрерывных управлений:
\begin{displaymath}
	J(u)=\phi(x(t_f))\rightarrow\min,
\end{displaymath}
\begin{displaymath}
	\dot{x}=f(x,u,t),x(t_0)=x_0,
\end{displaymath}
\begin{displaymath}
	u(t)\in\mathbb{U},t\in[t_0,t_f].
\end{displaymath}
 Пусть $u^0(t), t\in[t_0,t_f]$, -- оптимальное управление, $x^0(t),t\in [t_0,t_f]$, -- оптимальная траектория, $\psi^0(t),t\in [t_0,t_f]$ -- сопряжённая траектория -- решение сопряженного уравнения
\begin{displaymath}
	\dot{\psi}=-\frac{\partial H(x^0(t),\psi,u^0(t),t)}{\partial x},\end{displaymath}
\begin{displaymath}
	\psi=-\frac{\partial \varphi(x^0(t_f)}{\partial x}.\end{displaymath}
	Тогда выполняется условие максимума гамильтониана:
\begin{displaymath}
	H(x^0(t),\psi^0(t),u^0(t),t)=\underset{u\in\mathbb{U}}\max H(x^0(t),\psi^0(t),u,t),t\in[t_0,t_f].
\end{displaymath}

\section{Представление входных и выходных сигналов дискретных стационарных линейных систем на основе
матрицы Ганкеля}\label{3sec:SIG}

\subsection{Построение матрицы Ганкеля}
Рассмотрим систему \cite{Yang} с $u(k) \in \mathbb{R}^l, y(k) \in \mathbb{R}^m, x(k) \in \mathbb{R}^n$ :
\begin{equation}
	\begin{split}
	 	x(k+1)=Ax(k)+Bu(k)\\
		y(k)=Cx(k)+Du(k)
	\end{split}
\end{equation}
где $A \in \mathbb{R}^{n \times n}, B \in \mathbb{R}^{n \times l}, C \in \mathbb{R}^{m \times n}, D \in \mathbb{R}^{m \times l}$ -- матрицы системы, $  k \in [1,T], T \in \mathbb{N}$.
Траектория сигналов $z_d=(z(1),\dots,z(k),\dots,z(T)) \in (\mathbb{R}^{n_z})^T$
линейной многомерной системы $P$. Система $P$ удовлетворяет $P \subset (\mathbb{R}^{n_z})^T $  с сегментом входа-выхода $z= \begin{bmatrix} u \\ y \end{bmatrix} \in P$, где $u \in (\mathbb{R}^m)^N $ -- входной сигнал, $y \in (\mathbb{R}^l)^N$ -- выходной.
%ASK
Матрица Ганкеля $H(z_d)$ с $N$ строками и $T-N$ столбцами составленная из ограниченного сигнала $z_d \in (\mathbb{R}^{z_n})^T$ обозначается как: 
\begin{equation}\label{H(z_d)}
	H(z_d)= \begin{pmatrix}
	z(1) && z(2) && \cdots && z(T-N+1) \\
	z(2) && z(3) && \cdots && z(T-N+2) \\
	\vdots && \vdots && \cdots && \vdots \\
	z(N) && z(N+1) && \cdots && z(T)
	\end{pmatrix}.
\end{equation}
Построенная матрица будет использоваться в MPC вместо модели без каких-либо промежуточных шагов.

\subsection{Прогнозирование на основе матрицы Ганкеля}

Для произвольного момента времени $k$, принятого за текущее время, ограничение $P|_T$ поведения $P$ для интервала $[1,T]$ определяется с использованием траектории сигнала как $z_d=(z(1),\dots,z(t),\dots,z(T)),z(t) \in \mathbb{R}^{n_z}$. Вектор столбец данных на горизонте управления для выхода и входа $z$ определяется как
\begin{equation}
	z_p=z_{k-N|k}=\begin{bmatrix}
		y(k-N) \\
		\vdots \\
		y(k) \\
		u(k-N) \\
		\vdots \\
		u(k)
	\end{bmatrix} \in \mathbb{R}^{(l+m)N},
\end{equation}
\begin{equation}
	z_f=z_{k|k+N-1}=\begin{bmatrix}
		z(k) \\
		z(k+1) \\
		\vdots \\
		z(k+N-1)
	\end{bmatrix} \in \mathbb{R}^{(l+m)N_1}.
\end{equation}
Далее, индекс $p$ обозначает относительное «прошлое», а $f$ - «будущее» соответственно. Чтобы избежать промежуточного шага для идентификации представления системы, прогнозирование траектории выполняется с помощью матрицы Ганкеля данных $H(z_d)$. При построении ганкелевой матрицы $H(z_d)$ все данные можно разделить на две части. Прошлый и будущий входной блок ганкелевых матриц определяется следующим образом:
\begin{equation}
	U_p=
	\begin{bmatrix}
		u(1) && u(2) && \dots && u(j) \\
		u(2) && u(3) && \dots && u(j+1) \\
		\vdots && \vdots && \ddots && \vdots \\
		u(N-1) && u(N) && \dots && u(N+j-1)
	\end{bmatrix},
\end{equation}
\begin{equation}
	U_f=
	\begin{bmatrix}
		u(N) && u(N+1) && \dots && u(N+j-1) \\
		u(N+1) && u(N+2) && \dots && u(N+j) \\
		\vdots && \vdots && \ddots && \vdots \\
		u(2N-1) && u(2N) && \dots && u(2N+j-2)
	\end{bmatrix}.
\end{equation}
Обозначения «прошлого» и «будущего» можно понять по первому столбцу. Матрица Ганкеля «будущего» блока следует за данными матрицы Ганкеля «прошлого» блока во временной последовательности. Число $N$ - это размерность строки блоков векторов данных, а $j$ - номер строки матрицы Ханкеля, которая должна быть достаточно большой. Это соотношение справедливо для всех столбцов. Размерность строки $U_f$ может отличаться от размерности $U_p$, что обеспечит дополнительную степень свободы для настройки предложенного алгоритма прогнозного управления. Прошлый и будущий выходной блок-ганкелевых матриц $Y_p$ и $Y_f$ определяются аналогично. В данной работе используются следующие сокращенные обозначения:
\begin{equation}
	H_p=\begin{bmatrix}
		Y_p \\ U_p
	\end{bmatrix},
	H_f=\begin{bmatrix}
		Y_f \\ U_f
	\end{bmatrix}.
\end{equation}
Наблюдения $z$ также можно разделить на две части:
\begin{equation}
	z^T=\begin{bmatrix}
		z^T_p && z^T_f
	\end{bmatrix},
\end{equation}
где $z_p$ -- известные данные, а $z_f$ -- вектор будущих данных.
Матрица проекции также может быть разделена на две части таким же образом:
\begin{equation}
	z=\begin{bmatrix}
		z_p \\ z_f
	\end{bmatrix}=\begin{bmatrix}
		H_p,H_f
	\end{bmatrix}g,
\end{equation}
если известная часть данных $z_p$ используется для параметра $g$ оценки  $\widehat{g}$, получается следующее соотношение.
\begin{equation}
	\widehat{g}=(H^T_pH_p)^{-1}H^T_pz_p,
\end{equation}
где $\widehat{g}=[g-0,g_1,\dots,g_r]$ -- вектор оцененного вектора изображения. Тогда оценки траекторий всех переменных для предсказания $z_f$:
\begin{equation}
	\widehat{z}_f=H_f\widehat{g}=H_f(H^T_pH_p)^{-1}H^T_pz_p
\end{equation}
Оценка $\widehat{z}_f=[y^T_f \; u^T_f]^T$ с использованием матриц данных $H_f$, $H_p$ и $z_p$ эффективна для будущих траекторий. Он выполняет ту же роль, что и оценки состояния (Фильтры Калмана и т. Д.) для прогнозирования будущих траекторий в традиционных подходах MPC. Эти методы используют прошлые данные до текущего момента времени для оценки будущих данных. Для управляемых систем можно рассчитать значения будущих траекторий на горизонте управления.