\chapter{Представление входных и выходных сигналов дискретных стационарных линейных систем на основе
матрицы Ганкеля}\label{chap1_1}

Являясь передовым методом управления, управление по прогнозируюшей модели (MPC) имеет широкий спектр технологически и экономически выгодных приложений. В доступных исследованиях было предложено множество различных реализаций MPC. Однако, базовая структура схем управления обычно включает явную или неявную модель управляемого процесса, а также оперативную оптимизацию управляемых переменных в течение заранее определенного горизонта управления для данного горизонта прогнозирования управляемых переменных

Разработка модели на сегодняшний день является наиболее важным и трудоемким шагом в реализации управления по прогнозирующей модели. Реализация MPC критически зависит от качества модели и возможности онлайн-оптимизации. Но на сегодняшний момент предлагается множество видов управления без моделей, в том числе и в MPC.

По сравнению с методами, основанными на моделях, методы, основанные на данных, можно разделить на прямые и косвенные. Подходы, основанные на прямых данных, нацелены на отображение входящих и выходящих сигналов. 
Косвенные подходы, основанные на данных, нацелены на извлечение признаков или символов из наблюдаемых наборов данных. Извлечение признаков может быть выполнено с использованием методов интеллектуального анализа данных или неконтролируемого машинного обучения.

Метод управления на основе данных должен иметь возможность максимально использовать системные данные. Эти данные используются для выбора и проектирования структур контроллера или используются для настройки его параметров.

В данной работе для описания контролируемых процессов вместо модели или динамической матрицы будет применятся матрица данных Ганкеля, основанная на поведении системы. Такое решение особенно подходит для задач управления на основе данных, так как оно рассматривает динамическую систему как набор траекторий, а не уравнений, таким образом, устанавливает явную связь между траекторией и системой, которая генерирует траекторию.


\section{Построение матрицы Ганкеля}
Существует несколько форм представления линейной системы с несколькими переменными. Форма пространства состояний из \cite{Yang} является наиболее часто используемой при идентификации системы с входными сигналами $u(k) \in \mathbb{R}^l$, выходными сигналами $y(k) \in \mathbb{R}^m$ и состояниями $x(k) \in \mathbb{R}^n$ :
\begin{equation}\label{hankel-sys}
	\begin{split}
	 	x(k+1)=Ax(k)+Bu(k) + Ke(k) \\
		y(k)=Cx(k)+Du(k) + e(k)
	\end{split}
\end{equation}
где $A \in \mathbb{R}^{n \times n}, B \in \mathbb{R}^{n \times l}, C \in \mathbb{R}^{m \times n}, D \in \mathbb{R}^{m \times l}$ -- матрицы системы, $  k \in [1,T], T \in \mathbb{N}$.

$e(k) \in \mathbb{R^m}$ -- белый шум с ковариацией $\Sigma_e$

$z_d=(z(1),\dots,z(k),\dots,z(T)) \in (\mathbb{R}^{n_z})^T$ -- траектория сигналов линейной многомерной системы $P$.

Система $P$ удовлетворяет $P \subset (\mathbb{R}^{n_z})^T $  с сегментом входа-выхода $z= \begin{bmatrix} u \\ y \end{bmatrix} \in P$, где $u \in (\mathbb{R}^m)^N $ -- входной сигнал, $y \in (\mathbb{R}^l)^N$ -- выходной.


Матрица Ганкеля $H(z_d)$ с $N$ строками и $T-N$ столбцами составленная из ограниченного сигнала $z_d \in (\mathbb{R}^{z_n})^T$ обозначается как: 
\begin{equation}\label{H(z_d)}
	H(z_d)= \begin{pmatrix}
	z(1) && z(2) && \cdots && z(T-N+1) \\
	z(2) && z(3) && \cdots && z(T-N+2) \\
	\vdots && \vdots && \cdots && \vdots \\
	z(N) && z(N+1) && \cdots && z(T)
	\end{pmatrix}.
\end{equation}
Построенная матрица данных будет использоваться в контроллере MPC вместо прогнозирующей модели без каких-либо промежуточных шагов.
Сигнал $u=(u(1),u(2),\dots,u(N))$ - постоянно возбуждающая траектория, определение которой будет в следующей главе.

\section{Представление системы поведения}

Для лучшего понимания динамической системы (\ref{hankel-sys}) ее можно рассматривать как набор пар входных и выходных сигналов $(x,y)$ в соответствующих функциональных пространствах.

Если забыть о динамике и состояниях, эффект поведения системы становится настолько простым, что его можно рассматривать как действия пар входных и выходных сигналов $(x,y)$, то есть «графа», состоящего из точек $(x,y)$ в плоскости $XY$.

График точек $(x,y)$ теперь можно визуально исследовать в реальной плоскости.

Предполагая, что система P управляема, она допускает следующее минимальное представление изображения 
\begin{equation}\label{P=z}
	P=\{z=M(\sigma)g \,\, | \,\, g\in(R^m)^N\}
\end{equation}
где вектор $g$ связан с сигналами, подающемися на вход, и начальными условиями системы, генерирующими траекторию.
Однако отображение $g$ на входящие сигналы и начальные условия системы не является инъективным, что означает, что решение $g$ уравнения (\ref{P=z}) не обязательно должно быть уникальным.

Также примем во внимание следующие предположения: 
\begin{itemize}
	\item Система P управляема.
	\item Входная компонента $u_d$ из $z_d$ постоянно выходит из порядка $N$.
\end{itemize}

Тогда представление изображения (\ref{P=z}) можно заменить формулой (\ref{z=H}) с эквивалентностью.

\begin{equation}\label{z=H}
	z=H(z_d)g
\end{equation}

Прямое преобразование показывает, что процесс, представленный уравнением (\ref{hankel-sys}) равняется системе, представленной уравнением (\ref{z=H}). Таким образом, система P может быть задана заданной траекторией $z_d$. На основе проекции новые векторы данных проецируются на плоскость, чтобы получить оценку будущей части. Поэтому мы стремимся избежать использования модельного представления P в предлагаемой конструкции управляющего данными контроллера.

\section{Прогнозирование на основе матрицы Ганкеля}

Для произвольного момента времени $k$, принятого за текущее время, ограничение $P|_T$ поведения $P$ для интервала $[1,T]$ определяется с использованием траектории сигнала как $z_d=(z(1),\dots,z(t),\dots,z(T)),z(t) \in \mathbb{R}^{n_z}$. Вектор столбец данных на горизонте управления для выхода и входа $z$ определяется как
\begin{equation}
	z_p=z_{k-N|k}=\begin{bmatrix}
		y(k-N) \\
		\vdots \\
		y(k) \\
		u(k-N) \\
		\vdots \\
		u(k)
	\end{bmatrix} \in \mathbb{R}^{(l+m)N},
\end{equation}
\begin{equation}
	z_f=z_{k|k+N-1}=\begin{bmatrix}
		z(k) \\
		z(k+1) \\
		\vdots \\
		z(k+N-1)
	\end{bmatrix} \in \mathbb{R}^{(l+m)N_1}.
\end{equation}
Далее, индекс $p$ обозначает относительное «прошлое», а $f$ - «будущее» соответственно. Чтобы избежать промежуточного шага для идентификации представления системы, прогнозирование траектории выполняется с помощью матрицы Ганкеля данных $H(z_d)$. При построении ганкелевой матрицы $H(z_d)$ все данные можно разделить на две части. Прошлый и будущий входной блок ганкелевых матриц определяется следующим образом:
\begin{equation}
	U_p=
	\begin{bmatrix}
		u(1) && u(2) && \dots && u(j) \\
		u(2) && u(3) && \dots && u(j+1) \\
		\vdots && \vdots && \ddots && \vdots \\
		u(N-1) && u(N) && \dots && u(N+j-1)
	\end{bmatrix},
\end{equation}
\begin{equation}
	U_f=
	\begin{bmatrix}
		u(N) && u(N+1) && \dots && u(N+j-1) \\
		u(N+1) && u(N+2) && \dots && u(N+j) \\
		\vdots && \vdots && \ddots && \vdots \\
		u(2N-1) && u(2N) && \dots && u(2N+j-2)
	\end{bmatrix}.
\end{equation}
Обозначения «прошлого» и «будущего» можно понять по первому столбцу. Матрица Ганкеля «будущего» блока следует за данными матрицы Ганкеля «прошлого» блока во временной последовательности. Число $N$ - это размерность строки блоков векторов данных, а $j$ - номер строки матрицы Ханкеля, которая должна быть достаточно большой. Это соотношение справедливо для всех столбцов.

Размерность строки $U_f$ может отличаться от размерности $U_p$, что обеспечит дополнительную степень свободы для настройки предложенного алгоритма прогнозного управления. Прошлый и будущий выходной блок-ганкелевых матриц $Y_p$ и $Y_f$ определяются аналогично. В данной работе используются следующие сокращенные обозначения:
\begin{equation}
	H_p=\begin{bmatrix}
		Y_p \\ U_p
	\end{bmatrix},
	H_f=\begin{bmatrix}
		Y_f \\ U_f
	\end{bmatrix}.
\end{equation}
Наблюдения $z$ также можно разделить на две части:
\begin{equation}
	z^T=\begin{bmatrix}
		z^T_p && z^T_f
	\end{bmatrix},
\end{equation}
где $z_p$ -- известные данные, а $z_f$ -- вектор будущих данных.
Матрица проекции также может быть разделена на две части таким же образом:
\begin{equation}
	z=\begin{bmatrix}
		z_p \\ z_f
	\end{bmatrix}=\begin{bmatrix}
		H_p,H_f
	\end{bmatrix}g,
\end{equation}
если известная часть данных $z_p$ используется для параметра $g$ оценки  $\widehat{g}$, получается следующее соотношение.
\begin{equation}
	\widehat{g}=(H^T_pH_p)^{-1}H^T_pz_p,
\end{equation}
где $\widehat{g}=[g-0,g_1,\dots,g_r]$ -- вектор оцененного вектора изображения. Тогда оценки траекторий всех переменных для предсказания $z_f$:
\begin{equation}
	\widehat{z}_f=H_f\widehat{g}=H_f(H^T_pH_p)^{-1}H^T_pz_p
\end{equation}
Оценка $\widehat{z}_f=[y^T_f \; u^T_f]^T$ с использованием матриц данных $H_f$, $H_p$ и $z_p$ эффективна для будущих траекторий. Он выполняет ту же роль, что и оценки состояния (Фильтры Калмана и т. Д.) для прогнозирования будущих траекторий в традиционных подходах MPC. Эти методы используют прошлые данные до текущего момента времени для оценки будущих данных. Для управляемых систем можно рассчитать значения будущих траекторий на горизонте управления.

\section{Уменьшение вычислительной сложности на основе ортогональной проекции}

Чтобы уменьшить вычислительную сложность предложенного предсказывающего контроллера, к матрице данных применяется правильное ортогональное разложение, а оптимизация строится с пониженным порядком. Основные компоненты служат для следующих целей: они качественно показывают фактический порядок, который требуется для выполнения соответствующего цикла управления, и, таким образом, помогают выбрать количество управляемых параметров $g$. Таким образом, они помогают решить, как долго управляющие сигналы должны записываться в каждом цикле управления.

Как было указано ранее, матрицы Ганкеля определяются с помощью $N$ -блочных строк и $j$ -блочных столбцов. Каждая строка является признаком разного момента времени для каждого цикла управления. Каждый столбец вектора данных является вектором выборки временного интервала. Тогда главный вопрос, на который нужно ответить, - как найти «правильную» основу. Цель состоит в том, чтобы минимизировать основные управляемые переменные $r$, сохраняя при этом производительность контроллера выше заранее определенного уровня. Для каждого момента выборки $k$ записывается полная матрица Ганкеля $H$ данных. Главные компоненты всех $H$ могут быть получены из сингулярного разложения $H$:

\begin{equation}
	\Sigma = U'HV
\end{equation}

$U^{N \times N}$ и $V^{l \times l}$ -- ортогональные матрицы.

$\Sigma^{N \times l}$-- диагональная матрица, имеющая сингулярные значения H, расположенные в порядке убывания.

Если матрица Ганкеля не адаптивна к моменту времени $k$, приведенная матрица, построенная с использованием главного базиса, будет оцениваться автономно. Ортонормированная матрица $U$ образует основу для всех возможных входных сигналов управления и выходных сигналов. В частности, каждый столбец $U$ составляет главное направление столбцов $V$. Сингулярное значение $\sigma_i$, образующее диагональ $\sigma$, указывает на относительную важность главных компонентов.

Пусть теперь $r$ - количество существенно ненулевых сингулярных значений, тогда $r$ можно принять за ранг $H$, который также является приблизительной размерностью пространства управления. В таком случае,
остальные сингулярные значения $\sigma_{i+1},\dots,\sigma_N$ можно считать нулевыми.

Каждая матрицы данных Ганкеля из циклов управления сокращается следующим образом:

\begin{equation}
	\begin{bmatrix}
	 	H^1_{red} \quad H^2_{red} \quad \dots \quad H^r_{red} 
	\end{bmatrix}
\end{equation}

Базис, представленный $U$, усекается до первых $r$ столбцов. Тогда отношение уравнения изображения, определенное с помощью уравнения (\ref{z=H}) сводится к:

\begin{equation}
	z = 
	\begin{bmatrix}
	 	H^1_{red} \quad H^2_{red} \quad \dots \quad H^r_{red} 
	\end{bmatrix} 
	\begin{bmatrix}
	 	g^1_{red} \\ g^2_{red} \\ \vdots \\ g^r_{red}								\end{bmatrix}
\end{equation}

Следовательно, количество управляемых переменных сокращается до $r$, что намного меньше заданного номера строки $j$.

Правильный подход, основанный на ортогональной декомпозиции, значительно уменьшает количество переменных решения $g$ с достаточно большого $j$ до $r$. Оперативная оптимизация может быть реализована на основе данных измерений, спроецированных на ортонормированной основе с помощью соответствующего преобразования ортогональной декомпозиции. Отмечается, что уменьшенная оптимизация снижает сложность онлайн-вычислений за счет производительности управления.
