\chapter{Управление по прогнозирующей модели на основе данных: точные данные}\label{chap2}

Являясь передовым методом управления, управление по прогнозируюшей модели (MPC) имеет широкий спектр технологически и экономически выгодных приложений. В доступных исследованиях было предложено множество различных реализаций MPC. Однако, базовая структура схем управления обычно включает явную или неявную модель управляемого процесса, а также оптимизацию управляемых переменных в течение заранее определенного горизонта управления для данного горизонта прогнозирования управляемых переменных.

Разработка модели на сегодняшний день является наиболее важным и трудоемким шагом в реализации управления по прогнозирующей модели. Реализация MPC критически зависит от качества модели и возможности онлайн-оптимизации. Но на сегодняшний момент предлагается множество видов управления без моделей \cite{Berberich,Yang}, в том числе и в MPC.

По сравнению с методами, основанными на моделях, методы, основанные на данных, можно разделить на прямые и косвенные \cite{Yang}. Подходы, основанные на прямых данных, нацелены на отображение входящих и выходящих сигналов. 
Косвенные подходы, основанные на данных, нацелены на извлечение признаков или символов из наблюдаемых наборов данных. Извлечение признаков может быть выполнено с использованием методов интеллектуального анализа данных или машинного обучения без учителя.

Метод управления на основе данных должен иметь возможность максимально использовать системные данные. Эти данные используются для выбора и проектирования структур регулятора или используются для настройки его параметров.

В данной работе для описания управляемых процессов вместо модели или динамической матрицы будет применятся матрица данных Ганкеля из \cite{Berberich}, основанная на поведении системы. Такое решение особенно подходит для задач управления на основе данных, так как оно рассматривает динамическую систему как набор траекторий, а не уравнений, таким образом, устанавливает явную связь между траекторией и системой, которая генерирует траекторию.

В последующей главе после формулировки требуемых определений и основных предположений в \ref{2sec:problem-formulation} рассмотрим построение простейшей прогнозирующей задачи на основе данных в \ref{2sec:simple-problem} и задачи с терминальными ограничениями-равенствами в \ref{2sec:problem-term-constr}, а также покажем в \ref{2sec:assimp}, что замкнутый контур в $n$-ступенчатой схеме управления по прогнозирующей модели является асимптотически устойчивым, как это сделано в \cite{Berberich}.

\section{Основные предположения}\label{2sec:problem-formulation}

\begin{Def}
	$\{x_k\}_{k=0}^{N-1}$ с $x_k \in \mathbb{R}^n$ постоянно возбуждающая порядка $L$, если $\rank (H_L(x))=nL$.
\end{Def}
Цель паботы -- управление неизвестной линейной стационарной системой $G$ c порядком $n$, с $m$ входами и $p$ выходами. 

\begin{Def}
	 Последовательность $\{u_k,y_k\}^{N-1}_{k=0}$ -- траектория линейной стационарной системы $G$, если существуют начальное состояние $\overline{x} \in \mathbb{R}^n$, а также соответсвующая траектория $\{x_k\}^N_{k=0}$ такая, что 
	 \begin{displaymath}
	 	x_{k+1}=Ax_{k+1}+Bu_k; \; x_0=\overline{x},
	 \end{displaymath}
	 \begin{displaymath}
	  	y_k=Cx_k+Du_k, \; k=0,\dots,N-1,
	 \end{displaymath}
	$(A,B,C,D)$ -- минимальные реализация $G$.
\end{Def}

\begin{theorem}\label{trajectoryTheorem}
	Предположим, что $\{u^d_k,y^d_k\}^{N-1}_{k=0}$ -- траектория линейной стационарной системы $G$, где $u$ -- постоянно возбуждающее управление порядка $L+n$.
\newline
Тогда $\{\overline{u}_k,\overline{y}_k\}^{L-1}_{k=0}$ -- траектория $G$, тогда и только тогда, когда $\exists \alpha \in \mathbb{R}^{N-L+1}$ такое, что
	\begin{equation}\label{formuleOfTrajectoryTheorem}
		\begin{bmatrix}
			H_L(u^d) \\
			H_L(y^d)
		\end{bmatrix} \alpha = 
		\begin{bmatrix}
			\overline{u} \\
			\overline{y}
		\end{bmatrix}.
	\end{equation}
\end{theorem}

\begin{Def}\label{defTrajectory}
Пара $(u^s,y^s) \in \mathbb{R}^{m+p}$ -- положение равновесия линейной стационарной системой $G$, если последовательность $\{\overline{u}_k,\overline{y}_k\}^{n-1}_{k=0}$ с $(\overline{u}_k,\overline{y}_k) = (u^s,y^s) \; \forall k \in \mathbb{I}{[0,n-1]} $ -- траектория $G$.
\end{Def}

	Для равновесия $(u^s,y^s)$ мы определим $u^s_n, y^s_n$ как столбец векторов содержащий $n$ раз $u^s$ и $y^s$, соответственно. Предположим, что система подчиняется ограничениям,
$u_t \in \mathbb{U} \subseteq \mathbb{R}^m, y_t \in \mathbb{Y} \subseteq \mathbb{R}^p \; \forall t \geq 0$, и предположим, что $(u^s, y^s) \in int(\mathbb{U} \times \mathbb{Y})$. $\{u^d_k,y^d_k\}^{N-1}_{k=0}$ -- априорно измереные траектории длинной $N$, использующиеся в (\ref{formuleOfTrajectoryTheorem}). Прогнозируемые входные и выходные траектории в момент времени $t$ в течение некоторого горизонта прогнозирования $L$ записываются как $\{\overline{u}_k(t),\overline{y}_k(t)\}^{L-1}_{k=-n}$.

Обратим внимание, что индексы времени начинаются с $k=-n$, так как последние $n$ входных и выходных сигналов будут использоваться для вызова уникального начального состояния в момент времени $t$. Кроме того, обратная связь, состояние в некоторой минимальной реализации и выход в момент времени $t$ обозначаются как $u_t,x_t, y_t$, соответственно.

	
\section{Простейшая прогнозирующая задача на основе данных}\label{2sec:simple-problem}
	Теорема \ref{trajectoryTheorem} обеспечивает привлекательную альтернативу математической модели в пространстве состояний, так как (\ref{formuleOfTrajectoryTheorem}) достаточно, чтобы охватить все траектории системы. Таким образом, для реализации схемы MPC, основанной на данных, можно просто заменить динамику системы ограничением, которому удовлетворяют прогнозируемые траектории входа-выхода (\ref{formuleOfTrajectoryTheorem}). Чтобы быть более точным, предложенная схема MPC решает задачу на основе данных
\begin{equation}\label{problem1a}
		J_L(u_{[t-n,t-1]},y_{[t-n,t-1]},\alpha(t))=\sum^{L-1}_{k=0} \ell(\overline{u}_k(t),\overline{y}_k(t)),
\end{equation}
\begin{equation}\label{problem1b}
	\begin{bmatrix}
		\overline{u}_{[-n,-L-1]}(t) \\
		\overline{y}_{[-n,-L-1]}(t)
	\end{bmatrix} = 
	\begin{bmatrix}
		H_{L+n}(u^d) \\ 
		H_{L+n}(y^d)
	\end{bmatrix} \alpha(t),	
\end{equation}
\begin{equation}\label{problem1c}
	\begin{bmatrix}
		\overline{u}_{[-n,-1]}(t) \\ 
		\overline{y}_{[-n,-1]}(t) 
	\end{bmatrix} = 
	\begin{bmatrix}
		u_{[t-n,t-1]} \\
		y_{[t-n,t-1]}
	\end{bmatrix},
\end{equation}
где $
\ell(\overline{u},\overline{y})=\|\overline{u}-u^s\|_R^2+\|\overline{y}-y^s\|_Q^2, \: Q,R \succ 0.
$

Ограничение (\ref{problem1b}) заменяет динамику системы по сравнению с классическими схемами MPC на основе моделей. Кроме того, (\ref{problem1c}) гарантирует, что внутреннее состояние истинной траектории совпадает с внутренним состоянием прогнозируемой траектории в момент времени $t$.
Начальные траектории указываются до временного шага $t - 1$, поскольку входной сигнал в момент времени $t$ может уже влиять на выходной сигнал в момент времени $t$. Стоимость (\ref{problem1a}) зависит только от переменной оптимизации $\alpha(t)$, поскольку $\overline{u}(t)$ и $\overline{y}(t)$ неявно фиксируются через динамическое ограничение (\ref{problem1b}).

\section{Задача с терминальными ограничениями-равенствами}\label{2sec:problem-term-constr}
	В этом пункте рассмотрим простое терминальное ограничение, предложенное в \cite{Berberich}, которое может быть включено непосредственно в структуру управления данными MPC. Задачу сформулируем в виде
\begin{equation}\label{problem2a}
		J^*_L(u_{[t-n,t-1]},y_{[t-n,t-1]}) = \underset{\substack{\alpha(t)\ \overline{u}(t),\overline{y}(t)}} \min \sum^{L-1}_{k=0}\ell(\overline{u}_k(t),\overline{y}_k(t)),
\end{equation}
\begin{equation}\label{problem2b}
	\begin{bmatrix}
		\overline{u}_{[-n,-L-1]}(t) \\
		\overline{y}_{[-n,-L-1]}(t)
	\end{bmatrix} = 
	\begin{bmatrix}
		H_{L+n}(u^d) \\ 
		H_{L+n}(y^d)
	\end{bmatrix}\alpha(t),	
\end{equation}
\begin{equation}\label{problem2c}
	\begin{bmatrix}
		\overline{u}_{[-n,-1]}(t) \\ 
		\overline{y}_{[-n,-1]}(t) 
	\end{bmatrix} = 
	\begin{bmatrix}
		u_{[t-n,t-1]} \\
		y_{[t-n,t-1]}
	\end{bmatrix},
\end{equation}
\begin{equation}\label{problem2d}
	\begin{bmatrix}
		\overline{u}_{[L-n,L-1]}(t) \\ 
		\overline{y}_{[L-n,L-1]}(t) 
	\end{bmatrix} = 
	\begin{bmatrix}
		u_{n}^s \\
		y_{n}^s
	\end{bmatrix},
\end{equation}
\begin{equation}\label{problem2e}
	\overline{u}_k(t) \in \mathbb{U}, \overline{y}_k(t) \in \mathbb{Y}, k \in \mathbb{I}_{[0,L-1]}.
\end{equation}

Терминальное ограничение-равенство (\ref{problem2d}) подразумевает, что $\overline{x}_L(t)$, который является внутренним состоянием, предсказанным на $L$ шагов вперед, соответствующей предсказанной траекторией, равно постоянному состоянию $x^s$, соответствующему $(u^s, y^s)$, то есть $\overline{x}_L(t)=x^s$ в любой минимальной реализации. В то время как задача требует, чтобы $(u^s, y^s)$ было равновесием неизвестной системы по определению (\ref{defTrajectory}), это требование может быть отброшено, когда $(u^s, y^s)$ заменено искусственным равновесием, которое также оптимизируется онлайн. Как и в стандартном MPC, задача решена в виде отступающего горизонта, который обобщен в алгоритме (\ref{Alg1}).

\newtheorem{algorithm}{Алгоритм}
\begin{algorithm}\label{Alg1} (Схема управления на основе MPC)
	\begin{enumerate}
		\item В момент времени $t$ взять прошлые $n$ измерений $u_{[t-n,t-1]}, y_{[t-n,t-1]}$  и решить задачу (\ref{problem2a})--(\ref{problem2e}).
		\item Взять за управление $u_t=\overline{u}_0^*(t)$, где $\overline{u}_0^*(t)$ -- найденное оптимальное управление.
		\item Установить $t=t+1$ и вернуться к пункту 1).
	\end{enumerate}
\end{algorithm}


\section{Асимптотическая устойчивость замкнутого контура}\label{2sec:assimp}
Для анализа предположим, что $u^s = 0, y^s = 0$ и, следовательно, $x^s = 0$. Далее определим множество начальных состояний, для которых (\ref{problem2a}) -- (\ref{problem2d}) имеет решение, $x_L=\{x\in\mathbb{R}^n | J^*_L(x) < \infty\}$. Для доказательства экспоненциальной устойчивости предложенной схемы предположим, что функция оптимальных значения (\ref{problem2a}) -- (\ref{problem2d}) ограничена сверху.

\newtheorem{assump}{Предположение}
\begin{assump}\label{assump1}
	Функция оптимальных значения $J^*_L(x)$ -- ограничена сверху на $\mathbb{X_L}$, т.е. $\exists \, c_u>0$ такое, что $J^*_L(x)\leq c_u\|x\|_2^2 \;\, \forall x \in \mathbb{X}_L$
\end{assump}

\begin{theorem}{\cite{Berberich}}
	Пусть предположение (\ref{assump1}) верно, $L \geq n, \{u^d_k,y^d_k\}^{N-1}_{k=0}$ -- траектория линейной стационарной системы $G$, где $u^d$ -- постоянно возбуждающий порядка $L+2n$.
	Если задача MPC (\ref{problem2a}) -- (\ref{problem2d}) имеет решение в начальный момент времени $t=0$:
	\begin{enumerate}
		\item задача (\ref{problem2a}) -- (\ref{problem2d}) имеет решение при $\forall \: t$,
		\item выполняются ограничения $u_t \in \mathbb{U}, y_t \in \mathbb{Y} \; \forall t \in \mathbb{N}$,
		\item равновесие $x^s=0$ экспоненциально устойчиво для полученного замкнутого цикла.
	\end{enumerate}
\end{theorem}

